<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jayden Chat - Comunicación Segura</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <!-- CryptoJS para cifrado -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary: #00C851;
        --primary-dark: #009624;
        --accent: #00ff88;
        --dark: #0a1929;
        --darker: #051423;
        --light: #ffffff;
        --gray-light: #1e2a3a;
        --gray: #8b9cb1;
        --gray-dark: #6c757d;
        --card-bg: #15202b;
        --border: #2d3e50;
        --text-light: #ffffff;
        --text-gray: #8b9cb1;
        --transition: all 0.3s ease;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.4);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Montserrat', sans-serif;
    }
    
    body {
        background: var(--darker);
        color: var(--text-light);
        line-height: 1.6;
        min-height: 100vh;
        padding: 0;
        overflow-x: hidden;
    }
    
    /* Header */
    .app-header {
        background: var(--dark);
        color: var(--text-light);
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
        border-bottom: 1px solid var(--border);
    }
    
    .header-content {
        max-width: 100%;
        margin: 0 auto;
        padding: 0 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        font-size: 1.4rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text-light);
    }
    
    .logo img {
        height: 32px;
        width: auto;
        border-radius: 6px;
    }
    
    .header-actions {
        display: flex;
        gap: 15px;
    }
    
    .header-btn {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        padding: 8px;
        border-radius: 50%;
    }
    
    .header-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    /* Search Bar */
    .search-container {
        padding: 10px 15px;
        background: var(--dark);
        border-bottom: 1px solid var(--border);
    }
    
    .search-box {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .search-box i {
        color: var(--text-gray);
    }
    
    .search-input {
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 0.9rem;
        width: 100%;
        outline: none;
    }
    
    .search-input::placeholder {
        color: var(--text-gray);
    }
    
    /* Main Container */
    .app-container {
        max-width: 100%;
        margin: 0 auto;
        min-height: calc(100vh - 130px);
        background: var(--darker);
        padding-bottom: 70px; /* Espacio para la navegación inferior */
    }
    
    /* Content Sections */
    .content-section {
        display: none;
        animation: fadeIn 0.3s ease;
        background: var(--darker);
    }
    
    .content-section.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Chat List */
    .chat-list {
        background: var(--darker);
    }
    
    .chat-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .chat-item:last-child {
        border-bottom: none;
    }
    
    .chat-item:hover {
        background: var(--dark);
    }
    
    .chat-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--primary);
        border: 2px solid var(--card-bg);
    }
    
    .chat-info {
        flex: 1;
        min-width: 0;
    }
    
    .chat-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .last-message {
        font-size: 0.85rem;
        color: var(--text-gray);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .chat-meta {
        text-align: right;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: var(--text-gray);
        margin-bottom: 4px;
    }
    
    .unread-badge {
        background: var(--primary);
        color: white;
        border-radius: 10px;
        padding: 2px 8px;
        font-size: 0.7rem;
        font-weight: bold;
    }
    
    /* Contact List */
    .contact-list {
        background: var(--darker);
    }
    
    .contact-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .contact-item:last-child {
        border-bottom: none;
    }
    
    .contact-item:hover {
        background: var(--dark);
    }
    
    .contact-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .contact-info {
        flex: 1;
    }
    
    .contact-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .contact-status {
        font-size: 0.85rem;
        color: var(--text-gray);
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    /* Status Section */
    .status-section {
        background: var(--darker);
        padding: 15px;
    }
    
    .my-status {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 15px;
        cursor: pointer;
    }
    
    .my-status:hover {
        background: var(--dark);
        margin: -10px -15px;
        padding: 10px 15px;
        border-radius: 8px;
    }
    
    .status-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.3rem;
        border: 3px solid var(--primary);
    }
    
    .status-info h3 {
        font-size: 1rem;
        margin-bottom: 5px;
        color: var(--text-light);
    }
    
    .status-info p {
        font-size: 0.85rem;
        color: var(--text-gray);
    }
    
    .recent-updates {
        margin-top: 15px;
    }
    
    .recent-updates h3 {
        font-size: 1rem;
        margin-bottom: 10px;
        color: var(--text-light);
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
    }
    
    .status-item:last-child {
        border-bottom: none;
    }
    
    .status-item:hover {
        background: var(--dark);
        margin: -10px -15px;
        padding: 10px 15px;
        border-radius: 8px;
    }
    
    .status-avatar-small {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1rem;
        border: 2px solid var(--primary);
    }
    
    .status-content {
        flex: 1;
    }
    
    .status-user {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .status-text {
        font-size: 0.85rem;
        color: var(--text-gray);
    }
    
    .status-time {
        font-size: 0.75rem;
        color: var(--text-gray);
    }
    
    /* Chat View */
    .chat-view {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--darker);
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
    }
    
    .chat-view.active {
        transform: translateX(0);
    }
    
    .chat-header {
        background: var(--dark);
        color: var(--text-light);
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: var(--shadow);
        border-bottom: 1px solid var(--border);
    }
    
    .back-button {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 5px;
    }
    
    .chat-header-actions {
        display: flex;
        gap: 10px;
        margin-left: auto;
    }
    
    .chat-header-btn {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: var(--transition);
    }
    
    .chat-header-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .chat-header-info {
        flex: 1;
    }
    
    .chat-header-info h3 {
        font-size: 1.1rem;
        margin-bottom: 2px;
        color: var(--text-light);
    }
    
    .chat-header-info p {
        font-size: 0.8rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 5px;
        color: var(--text-gray);
    }
    
    .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: var(--darker);
    }
    
    .message {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        position: relative;
        animation: messageAppear 0.3s ease;
        word-wrap: break-word;
    }
    
    @keyframes messageAppear {
        0% { opacity: 0; transform: translateY(10px) scale(0.95); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .message.sent {
        align-self: flex-end;
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .message.received {
        align-self: flex-start;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-bottom-left-radius: 4px;
        color: var(--text-light);
    }
    
    .message-content {
        word-break: break-word;
        line-height: 1.4;
        font-size: 0.95rem;
    }
    
    .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 5px;
        text-align: right;
        color: rgba(255, 255, 255, 0.6);
    }
    
    /* Message Input Container - Estilo WhatsApp */
    .message-input-container {
        padding: 10px 15px;
        background: var(--dark);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .emoji-btn {
        background: none;
        border: none;
        color: var(--text-gray);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }
    
    .emoji-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .attach-btn {
        background: none;
        border: none;
        color: var(--text-gray);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: rotate(45deg);
        transition: var(--transition);
    }
    
    .attach-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .message-input-wrapper {
        flex: 1;
        background: var(--card-bg);
        border-radius: 25px;
        padding: 5px 15px;
        display: flex;
        align-items: center;
        min-height: 45px;
        border: 1px solid var(--border);
        transition: var(--transition);
    }
    
    .message-input-wrapper:focus-within {
        border-color: var(--primary);
    }
    
    .message-input {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 0.95rem;
        padding: 8px 0;
        resize: none;
        height: auto;
        min-height: 25px;
        max-height: 100px;
        outline: none;
        line-height: 1.4;
    }
    
    .message-input::placeholder {
        color: var(--text-gray);
    }
    
    .voice-btn {
        background: none;
        border: none;
        color: var(--text-gray);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }
    
    .voice-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .camera-btn {
        background: none;
        border: none;
        color: var(--text-gray);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }
    
    .camera-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .send-button {
        background: var(--primary);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        transition: var(--transition);
    }
    
    .send-button:active {
        transform: scale(0.95);
    }
    
    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--dark);
        border-top: 1px solid var(--border);
        display: flex;
        padding: 8px 0;
        z-index: 100;
    }
    
    .nav-item {
        flex: 1;
        text-align: center;
        padding: 8px 0;
        color: var(--text-gray);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        background: none;
        font-size: 0.75rem;
    }
    
    .nav-item.active {
        color: var(--primary);
    }
    
    .nav-item i {
        display: block;
        font-size: 1.3rem;
        margin-bottom: 4px;
    }
    
    /* Settings Menu */
    .settings-menu {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: var(--dark);
        z-index: 1100;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
        overflow-y: auto;
    }
    
    .settings-menu.active {
        right: 0;
    }
    
    .settings-header {
        background: var(--card-bg);
        padding: 20px;
        border-bottom: 1px solid var(--border);
    }
    
    .settings-header h2 {
        font-size: 1.3rem;
        margin-bottom: 5px;
    }
    
    .settings-items {
        padding: 10px 0;
    }
    
    .settings-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .settings-item:last-child {
        border-bottom: none;
    }
    
    .settings-item:hover {
        background: var(--card-bg);
    }
    
    .settings-item i {
        font-size: 1.2rem;
        color: var(--primary);
        width: 24px;
        text-align: center;
    }
    
    /* Profile Section */
    .profile-section {
        padding: 20px;
        background: var(--card-bg);
        margin: 15px;
        border-radius: 12px;
        text-align: center;
    }
    
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 2rem;
        margin: 0 auto 15px;
        border: 4px solid var(--primary);
    }
    
    .profile-name {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .profile-email {
        color: var(--text-gray);
        font-size: 0.9rem;
    }
    
    /* Overlay */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1050;
        display: none;
    }
    
    .overlay.active {
        display: block;
    }
    
    /* Voice Recording */
    .voice-recording {
        display: none;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        background: var(--primary);
        color: white;
        border-radius: 25px;
        margin: 0 10px;
    }
    
    .voice-recording.active {
        display: flex;
    }
    
    .recording-time {
        font-weight: 600;
    }
    
    .recording-controls {
        display: flex;
        gap: 15px;
    }
    
    .recording-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
        .app-container {
            min-height: calc(100vh - 140px);
        }
        
        .chat-item, .contact-item, .status-item {
            padding: 12px 15px;
        }
        
        .chat-avatar, .contact-avatar {
            width: 45px;
            height: 45px;
            font-size: 1rem;
        }
        
        .message {
            max-width: 85%;
        }
        
        .message-input-container {
            padding: 8px 12px;
            gap: 6px;
        }
        
        .emoji-btn, .attach-btn, .voice-btn, .camera-btn, .send-button {
            width: 38px;
            height: 38px;
            font-size: 1.1rem;
        }
        
        .message-input-wrapper {
            min-height: 42px;
            padding: 4px 12px;
        }
        
        .nav-item {
            font-size: 0.7rem;
        }
        
        .nav-item i {
            font-size: 1.2rem;
        }
        
        .chat-header-actions {
            gap: 8px;
        }
        
        .chat-header-btn {
            font-size: 1.1rem;
            padding: 6px;
        }
    }
    
    @media (min-width: 768px) {
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            box-shadow: var(--shadow-lg);
            min-height: 100vh;
        }
        
        .bottom-nav {
            max-width: 500px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .settings-menu {
            width: 350px;
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/welding30001994/Jayden_control/refs/heads/main/jayden.jpeg" alt="Jayden Chat">
                <span>Jayden Chat</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="header-btn" id="menuBtn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Search Bar -->
    <div class="search-container" id="searchContainer" style="display: none;">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" class="search-input" id="searchInput" placeholder="Buscar contactos...">
        </div>
    </div>

    <!-- Main Content -->
    <main class="app-container">
        <!-- Chats Section -->
        <section id="chats" class="content-section active">
            <div class="chat-list" id="chatsList">
                <!-- Los chats se cargarán aquí dinámicamente -->
            </div>
        </section>

        <!-- Contacts Section -->
        <section id="contacts" class="content-section">
            <div class="contact-list" id="contactsList">
                <!-- Los contactos se cargarán aquí dinámicamente -->
            </div>
        </section>

        <!-- Status Section -->
        <section id="status" class="content-section">
            <div class="status-section">
                <div class="my-status">
                    <div class="status-avatar" id="myStatusAvatar">U</div>
                    <div class="status-info">
                        <h3 id="myStatusName">Mi estado</h3>
                        <p>Toca para agregar una actualización</p>
                    </div>
                </div>
                
                <div class="recent-updates">
                    <h3>Actualizaciones recientes</h3>
                    <div id="statusUpdates">
                        <!-- Los estados se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Chat View (Oculto por defecto) -->
    <div class="chat-view" id="chatView">
        <div class="chat-header">
            <button class="back-button" id="backFromChat">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="chat-avatar" id="chatHeaderAvatar">
                <div class="online-indicator" id="chatHeaderOnline"></div>
            </div>
            <div class="chat-header-info">
                <h3 id="chatWithName">Usuario</h3>
                <p id="chatHeaderStatus"><i class="fas fa-circle"></i> En línea</p>
            </div>
            <div class="chat-header-actions">
                <button class="chat-header-btn" id="videoCallBtn">
                    <i class="fas fa-video"></i>
                </button>
                <button class="chat-header-btn" id="voiceCallBtn">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="chat-header-btn" id="chatMenuBtn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Los mensajes se cargarán aquí dinámicamente -->
        </div>
        
        <div class="message-input-container">
            <button class="emoji-btn" id="emojiBtn">
                <i class="far fa-smile"></i>
            </button>
            <button class="attach-btn" id="attachBtn">
                <i class="fas fa-plus"></i>
            </button>
            
            <!-- Input normal -->
            <div class="message-input-wrapper" id="textInputWrapper">
                <textarea class="message-input" id="messageInput" placeholder="Escribe un mensaje..." rows="1"></textarea>
            </div>
            
            <!-- Grabación de voz -->
            <div class="voice-recording" id="voiceRecording">
                <div class="recording-time" id="recordingTime">0:00</div>
                <div class="recording-controls">
                    <button class="recording-btn" id="cancelRecording">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="recording-btn" id="sendRecording">
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>
            
            <button class="voice-btn" id="voiceBtn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="camera-btn" id="cameraBtn">
                <i class="fas fa-camera"></i>
            </button>
            <button class="send-button" id="sendMessageBtn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Settings Menu -->
    <div class="settings-menu" id="settingsMenu">
        <div class="settings-header">
            <h2>Ajustes</h2>
            <p>Configura tu cuenta y preferencias</p>
        </div>
        
        <div class="profile-section">
            <div class="profile-avatar" id="profileAvatar">U</div>
            <div class="profile-name" id="profileName">Usuario</div>
            <div class="profile-email" id="profileEmail">usuario@ejemplo.com</div>
        </div>
        
        <div class="settings-items">
            <div class="settings-item" id="editProfileBtn">
                <i class="fas fa-user-edit"></i>
                <span>Editar perfil</span>
            </div>
            <div class="settings-item" id="newGroupBtn">
                <i class="fas fa-users"></i>
                <span>Nuevo grupo</span>
            </div>
            <div class="settings-item" id="linkedDevicesBtn">
                <i class="fas fa-link"></i>
                <span>Dispositivos vinculados</span>
            </div>
            <div class="settings-item" id="privacyBtn">
                <i class="fas fa-lock"></i>
                <span>Privacidad y seguridad</span>
            </div>
            <div class="settings-item" id="themeBtn">
                <i class="fas fa-palette"></i>
                <span>Tema (Claro/Oscuro)</span>
            </div>
            <div class="settings-item" id="blockedUsersBtn">
                <i class="fas fa-ban"></i>
                <span>Usuarios bloqueados</span>
            </div>
            <div class="settings-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar sesión</span>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-tab="chats">
            <i class="fas fa-comments"></i>
            <span>Chats</span>
        </button>
        <button class="nav-item" data-tab="contacts">
            <i class="fas fa-users"></i>
            <span>Contactos</span>
        </button>
        <button class="nav-item" data-tab="status">
            <i class="fas fa-circle"></i>
            <span>Estados</span>
        </button>
    </nav>

    <script>
        // Inicializar Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB1Cs2os3tTfrMbYSAmDeJAGnP4tTtsFdw",
            authDomain: "beaver-trading.firebaseapp.com",
            databaseURL: "https://beaver-trading-default-rtdb.firebaseio.com",
            projectId: "beaver-trading",
            storageBucket: "beaver-trading.firebasestorage.app",
            messagingSenderId: "926610131904",
            appId: "1:926610131904:web:c147bd337bd12b4d085625",
            measurementId: "G-1K51WWF2ZJ"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
        
        // Variables globales
        let currentUser = null;
        let selectedUser = null;
        let usersRef = null;
        let messagesRef = null;
        let statusRef = null;
        let filteredContacts = [];
        let isRecording = false;
        let recordingTimer = null;
        let recordingSeconds = 0;
        
        // Elementos del DOM
        const chatsList = document.getElementById('chatsList');
        const contactsList = document.getElementById('contactsList');
        const statusUpdates = document.getElementById('statusUpdates');
        const chatView = document.getElementById('chatView');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const backFromChat = document.getElementById('backFromChat');
        const myStatusAvatar = document.getElementById('myStatusAvatar');
        const myStatusName = document.getElementById('myStatusName');
        const chatHeaderAvatar = document.getElementById('chatHeaderAvatar');
        const chatHeaderOnline = document.getElementById('chatHeaderOnline');
        const chatHeaderStatus = document.getElementById('chatHeaderStatus');
        const searchContainer = document.getElementById('searchContainer');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const menuBtn = document.getElementById('menuBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const overlay = document.getElementById('overlay');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const voiceBtn = document.getElementById('voiceBtn');
        const cameraBtn = document.getElementById('cameraBtn');
        const emojiBtn = document.getElementById('emojiBtn');
        const attachBtn = document.getElementById('attachBtn');
        const voiceRecording = document.getElementById('voiceRecording');
        const recordingTime = document.getElementById('recordingTime');
        const cancelRecording = document.getElementById('cancelRecording');
        const sendRecording = document.getElementById('sendRecording');
        const textInputWrapper = document.getElementById('textInputWrapper');
        const videoCallBtn = document.getElementById('videoCallBtn');
        const voiceCallBtn = document.getElementById('voiceCallBtn');
        const chatMenuBtn = document.getElementById('chatMenuBtn');
        
        // Verificar autenticación
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                setupUser(user);
                loadUsers();
                loadChats();
                loadStatusUpdates();
                setupPresence();
                updateProfileInfo();
            } else {
                window.location.href = 'index.html';
            }
        });
        
        // Configurar usuario
        function setupUser(user) {
            database.ref('users/' + user.uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    myStatusName.textContent = userData.name || 'Mi estado';
                    myStatusAvatar.textContent = (userData.name || 'U').charAt(0).toUpperCase();
                } else {
                    const displayName = user.email.split('@')[0];
                    myStatusName.textContent = 'Mi estado';
                    myStatusAvatar.textContent = displayName.charAt(0).toUpperCase();
                    
                    database.ref('users/' + user.uid).set({
                        name: displayName,
                        email: user.email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            });
        }
        
        // Actualizar información del perfil
        function updateProfileInfo() {
            if (currentUser) {
                database.ref('users/' + currentUser.uid).once('value').then((snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        profileName.textContent = userData.name || 'Usuario';
                        profileEmail.textContent = userData.email || currentUser.email;
                        profileAvatar.textContent = (userData.name || 'U').charAt(0).toUpperCase();
                    }
                });
            }
        }
        
        // Cargar usuarios para contactos
        function loadUsers() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                contactsList.innerHTML = '';
                const users = snapshot.val();
                filteredContacts = [];
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            filteredContacts.push({ userId, ...user });
                            createContactItem(userId, user);
                        }
                    });
                }
                
                if (filteredContacts.length === 0) {
                    contactsList.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                            <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay contactos disponibles</p>
                            <p style="font-size: 0.8rem; margin-top: 10px;">Los usuarios que se registren aparecerán aquí</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de contacto
        function createContactItem(userId, user) {
            const contactItem = document.createElement('div');
            contactItem.className = 'contact-item';
            contactItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            contactItem.innerHTML = `
                <div class="contact-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="contactOnline-${userId}"></div>
                </div>
                <div class="contact-info">
                    <div class="contact-name">${user.name || 'Usuario'}</div>
                    <div class="contact-status" id="contactStatus-${userId}">
                        <i class="fas fa-circle"></i> En línea
                    </div>
                </div>
            `;
            
            contactItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            contactsList.appendChild(contactItem);
            checkUserOnlineStatus(userId);
        }
        
        // Cargar chats
        function loadChats() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                chatsList.innerHTML = '';
                const users = snapshot.val();
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            createChatItem(userId, user);
                        }
                    });
                }
                
                if (chatsList.children.length === 0) {
                    chatsList.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                            <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay conversaciones</p>
                            <p style="font-size: 0.8rem; margin-top: 10px;">Inicia una conversación con tus contactos</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de chat
        function createChatItem(userId, user) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            chatItem.innerHTML = `
                <div class="chat-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="chatOnline-${userId}"></div>
                </div>
                <div class="chat-info">
                    <div class="chat-name">${user.name || 'Usuario'}</div>
                    <div class="last-message" id="lastMessage-${userId}">Haz clic para chatear</div>
                </div>
                <div class="chat-meta">
                    <div class="message-time" id="lastMessageTime-${userId}"></div>
                    <div class="unread-badge" id="unreadBadge-${userId}" style="display: none;">1</div>
                </div>
            `;
            
            chatItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            chatsList.appendChild(chatItem);
            checkUserOnlineStatus(userId);
            loadLastMessage(userId);
        }
        
        // Cargar últimos mensajes
        function loadLastMessage(userId) {
            const chatId = getChatId(currentUser.uid, userId);
            const lastMessageRef = database.ref('chats/' + chatId).orderByKey().limitToLast(1);
            
            lastMessageRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                const lastMessageElement = document.getElementById(`lastMessage-${userId}`);
                const lastMessageTimeElement = document.getElementById(`lastMessageTime-${userId}`);
                
                if (message) {
                    let messageText = message.text || '';
                    
                    if (lastMessageElement) {
                        lastMessageElement.textContent = messageText.substring(0, 30) + (messageText.length > 30 ? '...' : '');
                    }
                    
                    if (lastMessageTimeElement) {
                        const time = new Date(message.timestamp);
                        lastMessageTimeElement.textContent = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    }
                }
            });
        }
        
        // Cargar estados
        function loadStatusUpdates() {
            statusRef = database.ref('status_updates').orderByChild('timestamp').limitToLast(10);
            
            statusRef.on('value', (snapshot) => {
                statusUpdates.innerHTML = '';
                const updates = snapshot.val();
                
                if (updates) {
                    Object.keys(updates).forEach((updateId) => {
                        const update = updates[updateId];
                        createStatusItem(updateId, update);
                    });
                }
                
                if (statusUpdates.children.length === 0) {
                    statusUpdates.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-gray);">
                            <p>No hay actualizaciones recientes</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de estado
        function createStatusItem(updateId, update) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            
            // Obtener información del usuario
            database.ref('users/' + update.userId).once('value').then((userSnapshot) => {
                const user = userSnapshot.val();
                const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                
                statusItem.innerHTML = `
                    <div class="status-avatar-small">
                        ${avatarText}
                    </div>
                    <div class="status-content">
                        <div class="status-user">${user.name || 'Usuario'}</div>
                        <div class="status-text">${update.text || '📷 Imagen'}</div>
                    </div>
                    <div class="status-time">${formatTime(update.timestamp)}</div>
                `;
                
                statusUpdates.appendChild(statusItem);
            });
        }
        
        // Verificar estado en línea
        function checkUserOnlineStatus(userId) {
            const userStatusRef = database.ref('status/' + userId);
            
            userStatusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                const chatOnline = document.getElementById(`chatOnline-${userId}`);
                const contactOnline = document.getElementById(`contactOnline-${userId}`);
                const contactStatus = document.getElementById(`contactStatus-${userId}`);
                
                if (status && status.state === 'online') {
                    if (chatOnline) chatOnline.style.display = 'block';
                    if (contactOnline) contactOnline.style.display = 'block';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle"></i> En línea';
                } else {
                    if (chatOnline) chatOnline.style.display = 'none';
                    if (contactOnline) contactOnline.style.display = 'none';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle" style="color: #666"></i> Desconectado';
                }
            });
        }
        
        // Configurar presencia
        function setupPresence() {
            const userStatusRef = database.ref('status/' + currentUser.uid);
            
            userStatusRef.set({
                state: 'online',
                lastChanged: firebase.database.ServerValue.TIMESTAMP
            });
            
            window.addEventListener('beforeunload', () => {
                userStatusRef.set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            });
        }
        
        // Abrir chat
        function openChat(userId, user) {
            selectedUser = { id: userId, ...user };
            
            document.getElementById('chatWithName').textContent = user.name || 'Usuario';
            chatHeaderAvatar.textContent = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            // Actualizar estado en tiempo real en el header del chat
            checkUserOnlineStatusForChat(userId);
            
            chatView.classList.add('active');
            loadChatMessages(userId);
        }
        
        // Verificar estado para el chat abierto
        function checkUserOnlineStatusForChat(userId) {
            const userStatusRef = database.ref('status/' + userId);
            
            userStatusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                
                if (status && status.state === 'online') {
                    chatHeaderOnline.style.display = 'block';
                    chatHeaderStatus.innerHTML = '<i class="fas fa-circle"></i> En línea';
                } else {
                    chatHeaderOnline.style.display = 'none';
                    chatHeaderStatus.innerHTML = '<i class="fas fa-circle" style="color: #666"></i> Desconectado';
                }
            });
        }
        
        // Cargar mensajes del chat
        function loadChatMessages(userId) {
            chatMessages.innerHTML = '';
            
            const chatId = getChatId(currentUser.uid, userId);
            messagesRef = database.ref('chats/' + chatId);
            
            messagesRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });
        }
        
        // Mostrar mensaje en el chat
        function displayMessage(message) {
            const messageElement = document.createElement('div');
            
            const isSent = message.senderId === currentUser.uid;
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            
            // Mostrar mensaje sin cifrado en la interfaz
            const messageText = message.text || '';
            
            const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                <div class="message-content">${messageText}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Enviar mensaje
        function sendMessage() {
            const text = messageInput.value.trim();
            
            if (text && selectedUser) {
                const chatId = getChatId(currentUser.uid, selectedUser.id);
                const messageRef = database.ref('chats/' + chatId).push();
                const messageId = messageRef.key;
                
                // Guardar mensaje SIN cifrado en la base de datos
                messageRef.set({
                    text: text, // Sin cifrado
                    senderId: currentUser.uid,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    messageId: messageId
                });
                
                messageInput.value = '';
                adjustTextareaHeight();
            }
        }
        
        // Iniciar grabación de voz
        function startVoiceRecording() {
            isRecording = true;
            recordingSeconds = 0;
            textInputWrapper.style.display = 'none';
            voiceRecording.classList.add('active');
            
            recordingTimer = setInterval(() => {
                recordingSeconds++;
                const minutes = Math.floor(recordingSeconds / 60);
                const seconds = recordingSeconds % 60;
                recordingTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Detener grabación de voz
        function stopVoiceRecording() {
            isRecording = false;
            clearInterval(recordingTimer);
            textInputWrapper.style.display = 'flex';
            voiceRecording.classList.remove('active');
        }
        
        // ID único para chat
        function getChatId(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }
        
        // Formatear tiempo
        function formatTime(timestamp) {
            const time = new Date(timestamp);
            const now = new Date();
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Ahora';
            if (diffMins < 60) return `${diffMins}m`;
            return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Ajustar altura del textarea
        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 100) + 'px';
        }
        
        // Filtrar contactos
        function filterContacts(searchTerm) {
            const filtered = filteredContacts.filter(contact => 
                contact.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            contactsList.innerHTML = '';
            
            if (filtered.length === 0) {
                contactsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No se encontraron contactos</p>
                    </div>
                `;
            } else {
                filtered.forEach(contact => {
                    createContactItem(contact.userId, contact);
                });
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navegación por pestañas
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar pestañas activas
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Actualizar navegación inferior
                    navItems.forEach(item => {
                        if (item.dataset.tab === tabId) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                    
                    // Mostrar sección correspondiente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === tabId) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Navegación inferior
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar navegación inferior
                    navItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Actualizar pestañas superiores
                    navTabs.forEach(tab => {
                        if (tab.dataset.tab === tabId) {
                            tab.classList.add('active');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                    
                    // Mostrar sección correspondiente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === tabId) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Envío de mensajes
            sendMessageBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Ajustar altura del textarea dinámicamente
            messageInput.addEventListener('input', adjustTextareaHeight);

            // Volver del chat
            backFromChat.addEventListener('click', function() {
                chatView.classList.remove('active');
                if (messagesRef) {
                    messagesRef.off();
                }
            });

            // Búsqueda
            searchBtn.addEventListener('click', function() {
                searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';
                if (searchContainer.style.display === 'block') {
                    searchInput.focus();
                }
            });

            searchInput.addEventListener('input', function() {
                filterContacts(this.value);
            });

            // Menú de ajustes
            menuBtn.addEventListener('click', function() {
                settingsMenu.classList.add('active');
                overlay.classList.add('active');
            });

            overlay.addEventListener('click', function() {
                settingsMenu.classList.remove('active');
                overlay.classList.remove('active');
            });

            // Grabación de voz
            voiceBtn.addEventListener('click', function() {
                if (!isRecording) {
                    startVoiceRecording();
                } else {
                    stopVoiceRecording();
                }
            });

            cancelRecording.addEventListener('click', function() {
                stopVoiceRecording();
            });

            sendRecording.addEventListener('click', function() {
                stopVoiceRecording();
                // Aquí iría la lógica para enviar el audio
                alert('Audio enviado (funcionalidad en desarrollo)');
            });

            // Botones de la cámara y adjuntar
            cameraBtn.addEventListener('click', function() {
                alert('Cámara abierta (funcionalidad en desarrollo)');
            });

            attachBtn.addEventListener('click', function() {
                alert('Menú de adjuntar archivos (funcionalidad en desarrollo)');
            });

            emojiBtn.addEventListener('click', function() {
                alert('Selector de emojis (funcionalidad en desarrollo)');
            });

            // Botones del header del chat
            videoCallBtn.addEventListener('click', function() {
                alert('Llamada de video iniciada (funcionalidad en desarrollo)');
            });

            voiceCallBtn.addEventListener('click', function() {
                alert('Llamada de voz iniciada (funcionalidad en desarrollo)');
            });

            chatMenuBtn.addEventListener('click', function() {
                alert('Menú del chat (funcionalidad en desarrollo)');
            });

            // Estado personal
            document.querySelector('.my-status').addEventListener('click', function() {
                const statusText = prompt('¿Qué estás pensando?');
                if (statusText && statusText.trim() !== '') {
                    const statusRef = database.ref('status_updates').push();
                    statusRef.set({
                        userId: currentUser.uid,
                        text: statusText,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    alert('Estado actualizado correctamente');
                }
            });

            // Botones de ajustes
            document.getElementById('editProfileBtn').addEventListener('click', function() {
                const newName = prompt('Nuevo nombre:', profileName.textContent);
                if (newName && newName.trim() !== '') {
                    database.ref('users/' + currentUser.uid).update({
                        name: newName.trim()
                    }).then(() => {
                        updateProfileInfo();
                        alert('Perfil actualizado correctamente');
                    });
                }
            });

            document.getElementById('newGroupBtn').addEventListener('click', function() {
                alert('Funcionalidad de nuevo grupo en desarrollo');
            });

            document.getElementById('linkedDevicesBtn').addEventListener('click', function() {
                alert('Funcionalidad de dispositivos vinculados en desarrollo');
            });

            document.getElementById('privacyBtn').addEventListener('click', function() {
                alert('Configuración de privacidad y seguridad en desarrollo');
            });

            document.getElementById('themeBtn').addEventListener('click', function() {
                alert('Cambio de tema en desarrollo');
            });

            document.getElementById('blockedUsersBtn').addEventListener('click', function() {
                alert('Gestión de usuarios bloqueados en desarrollo');
            });

            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                    logout();
                }
            });
        });

        // Función para cerrar sesión
        function logout() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
            
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch(error => {
                console.error('Error al cerrar sesión:', error);
            });
        }

        // Manejar el evento de antes de descargar la página
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
        });

        // Inicializar altura del textarea
        adjustTextareaHeight();
    </script>
</body>
</html>