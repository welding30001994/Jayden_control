# App de Chat Mejorada con Navegaci칩n Inferior

Voy a crear una app completa con navegaci칩n inferior tipo WhatsApp que incluya Chats, Contactos y Estados. Aqu칤 est치 el c칩digo:

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jayden Chat - Comunicaci칩n Segura</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <!-- CryptoJS para cifrado -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary: #00C851;
        --primary-dark: #009624;
        --accent: #00ff88;
        --dark: #0a1929;
        --darker: #051423;
        --light: #ffffff;
        --gray-light: #f8f9fa;
        --gray: #6c757d;
        --gray-dark: #495057;
        --card-bg: #ffffff;
        --border: #e9ecef;
        --transition: all 0.3s ease;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.15);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Montserrat', sans-serif;
    }
    
    body {
        background: var(--gray-light);
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
        padding: 0;
        overflow-x: hidden;
    }
    
    /* Header */
    .app-header {
        background: var(--primary);
        color: white;
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
    }
    
    .header-content {
        max-width: 100%;
        margin: 0 auto;
        padding: 0 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        font-size: 1.4rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .logo img {
        height: 32px;
        width: auto;
        border-radius: 6px;
    }
    
    .header-actions {
        display: flex;
        gap: 15px;
    }
    
    .header-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        padding: 8px;
        border-radius: 50%;
    }
    
    .header-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    /* Main Container */
    .app-container {
        max-width: 100%;
        margin: 0 auto;
        min-height: calc(100vh - 130px);
        background: var(--gray-light);
    }
    
    /* Navigation Tabs */
    .nav-tabs {
        display: flex;
        background: var(--card-bg);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 70px;
        z-index: 90;
    }
    
    .nav-tab {
        flex: 1;
        text-align: center;
        padding: 15px 0;
        font-weight: 600;
        color: var(--gray);
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
    }
    
    .nav-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    .nav-tab i {
        display: block;
        font-size: 1.2rem;
        margin-bottom: 5px;
    }
    
    .nav-tab span {
        font-size: 0.8rem;
    }
    
    /* Content Sections */
    .content-section {
        display: none;
        padding: 15px;
        animation: fadeIn 0.3s ease;
    }
    
    .content-section.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Chat List */
    .chat-list {
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow);
    }
    
    .chat-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .chat-item:last-child {
        border-bottom: none;
    }
    
    .chat-item:hover {
        background: var(--gray-light);
    }
    
    .chat-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--primary);
        border: 2px solid white;
    }
    
    .chat-info {
        flex: 1;
        min-width: 0;
    }
    
    .chat-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: #333;
    }
    
    .last-message {
        font-size: 0.85rem;
        color: var(--gray);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .chat-meta {
        text-align: right;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: var(--gray);
        margin-bottom: 4px;
    }
    
    .unread-badge {
        background: var(--primary);
        color: white;
        border-radius: 10px;
        padding: 2px 8px;
        font-size: 0.7rem;
        font-weight: bold;
    }
    
    /* Contact List */
    .contact-list {
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow);
    }
    
    .contact-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
    }
    
    .contact-item:last-child {
        border-bottom: none;
    }
    
    .contact-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .contact-info {
        flex: 1;
    }
    
    .contact-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: #333;
    }
    
    .contact-status {
        font-size: 0.85rem;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    /* Status Section */
    .status-section {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: var(--shadow);
    }
    
    .my-status {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 15px;
    }
    
    .status-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.3rem;
        border: 3px solid var(--primary);
    }
    
    .status-info h3 {
        font-size: 1rem;
        margin-bottom: 5px;
        color: #333;
    }
    
    .status-info p {
        font-size: 0.85rem;
        color: var(--gray);
    }
    
    .recent-updates {
        margin-top: 15px;
    }
    
    .recent-updates h3 {
        font-size: 1rem;
        margin-bottom: 10px;
        color: #333;
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
    }
    
    .status-item:last-child {
        border-bottom: none;
    }
    
    .status-avatar-small {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1rem;
        border: 2px solid var(--primary);
    }
    
    .status-content {
        flex: 1;
    }
    
    .status-user {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 4px;
        color: #333;
    }
    
    .status-text {
        font-size: 0.85rem;
        color: var(--gray);
    }
    
    .status-time {
        font-size: 0.75rem;
        color: var(--gray);
    }
    
    /* Chat View */
    .chat-view {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--gray-light);
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
    }
    
    .chat-view.active {
        transform: translateX(0);
    }
    
    .chat-header {
        background: var(--primary);
        color: white;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: var(--shadow);
    }
    
    .back-button {
        background: none;
        border: none;
        color: white;
        font-size: 1.3rem;
        cursor: pointer;
        padding: 5px;
    }
    
    .chat-header-info {
        flex: 1;
    }
    
    .chat-header-info h3 {
        font-size: 1.1rem;
        margin-bottom: 2px;
    }
    
    .chat-header-info p {
        font-size: 0.8rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .message {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        position: relative;
        animation: messageAppear 0.3s ease;
        word-wrap: break-word;
    }
    
    @keyframes messageAppear {
        0% { opacity: 0; transform: translateY(10px) scale(0.95); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .message.sent {
        align-self: flex-end;
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .message.received {
        align-self: flex-start;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-bottom-left-radius: 4px;
        color: #333;
    }
    
    .message-content {
        word-break: break-word;
        line-height: 1.4;
        font-size: 0.95rem;
    }
    
    .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 5px;
        text-align: right;
    }
    
    .message-input-container {
        padding: 15px;
        background: var(--card-bg);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .message-input-wrapper {
        flex: 1;
        background: var(--gray-light);
        border-radius: 25px;
        padding: 5px 15px;
        display: flex;
        align-items: center;
        min-height: 45px;
    }
    
    .message-input {
        flex: 1;
        background: transparent;
        border: none;
        color: #333;
        font-size: 0.95rem;
        padding: 10px 0;
        resize: none;
        height: auto;
        min-height: 25px;
        max-height: 100px;
        outline: none;
        line-height: 1.4;
    }
    
    .attach-btn, .emoji-btn {
        background: none;
        border: none;
        color: var(--gray);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
    }
    
    .send-button {
        background: var(--primary);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
    }
    
    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--card-bg);
        border-top: 1px solid var(--border);
        display: flex;
        padding: 10px 0;
        z-index: 100;
    }
    
    .nav-item {
        flex: 1;
        text-align: center;
        padding: 8px 0;
        color: var(--gray);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        background: none;
        font-size: 0.8rem;
    }
    
    .nav-item.active {
        color: var(--primary);
    }
    
    .nav-item i {
        display: block;
        font-size: 1.3rem;
        margin-bottom: 4px;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
        .app-container {
            min-height: calc(100vh - 140px);
        }
        
        .content-section {
            padding: 10px;
        }
        
        .chat-item, .contact-item, .status-item {
            padding: 12px;
        }
        
        .chat-avatar, .contact-avatar {
            width: 45px;
            height: 45px;
            font-size: 1rem;
        }
        
        .message {
            max-width: 85%;
        }
    }
    
    @media (min-width: 768px) {
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            box-shadow: var(--shadow-lg);
            min-height: 100vh;
        }
        
        .bottom-nav {
            max-width: 500px;
            left: 50%;
            transform: translateX(-50%);
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/welding30001994/Jayden_control/refs/heads/main/jayden.jpeg" alt="Jayden Chat">
                <span>Jayden Chat</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="header-btn" id="menuBtn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <div class="nav-tab active" data-tab="chats">
            <i class="fas fa-comments"></i>
            <span>Chats</span>
        </div>
        <div class="nav-tab" data-tab="contacts">
            <i class="fas fa-users"></i>
            <span>Contactos</span>
        </div>
        <div class="nav-tab" data-tab="status">
            <i class="fas fa-circle"></i>
            <span>Estados</span>
        </div>
    </div>

    <!-- Main Content -->
    <main class="app-container">
        <!-- Chats Section -->
        <section id="chats" class="content-section active">
            <div class="chat-list" id="chatsList">
                <!-- Los chats se cargar치n aqu칤 din치micamente -->
            </div>
        </section>

        <!-- Contacts Section -->
        <section id="contacts" class="content-section">
            <div class="contact-list" id="contactsList">
                <!-- Los contactos se cargar치n aqu칤 din치micamente -->
            </div>
        </section>

        <!-- Status Section -->
        <section id="status" class="content-section">
            <div class="status-section">
                <div class="my-status">
                    <div class="status-avatar" id="myStatusAvatar">U</div>
                    <div class="status-info">
                        <h3 id="myStatusName">Mi estado</h3>
                        <p>Toca para agregar una actualizaci칩n</p>
                    </div>
                </div>
                
                <div class="recent-updates">
                    <h3>Actualizaciones recientes</h3>
                    <div id="statusUpdates">
                        <!-- Los estados se cargar치n aqu칤 din치micamente -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Chat View (Oculto por defecto) -->
    <div class="chat-view" id="chatView">
        <div class="chat-header">
            <button class="back-button" id="backFromChat">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="chat-avatar">
                <div class="online-indicator"></div>
            </div>
            <div class="chat-header-info">
                <h3 id="chatWithName">Usuario</h3>
                <p><i class="fas fa-circle"></i> En l칤nea</p>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Los mensajes se cargar치n aqu칤 din치micamente -->
        </div>
        
        <div class="message-input-container">
            <button class="attach-btn">
                <i class="fas fa-paperclip"></i>
            </button>
            <div class="message-input-wrapper">
                <textarea class="message-input" id="messageInput" placeholder="Escribe un mensaje..." rows="1"></textarea>
            </div>
            <button class="emoji-btn">
                <i class="far fa-smile"></i>
            </button>
            <button class="send-button" id="sendMessageBtn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-tab="chats">
            <i class="fas fa-comments"></i>
            <span>Chats</span>
        </button>
        <button class="nav-item" data-tab="contacts">
            <i class="fas fa-users"></i>
            <span>Contactos</span>
        </button>
        <button class="nav-item" data-tab="status">
            <i class="fas fa-circle"></i>
            <span>Estados</span>
        </button>
    </nav>

    <script>
        // Inicializar Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB1Cs2os3tTfrMbYSAmDeJAGnP4tTtsFdw",
            authDomain: "beaver-trading.firebaseapp.com",
            databaseURL: "https://beaver-trading-default-rtdb.firebaseio.com",
            projectId: "beaver-trading",
            storageBucket: "beaver-trading.firebasestorage.app",
            messagingSenderId: "926610131904",
            appId: "1:926610131904:web:c147bd337bd12b4d085625",
            measurementId: "G-1K51WWF2ZJ"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
        
        // Variables globales
        let currentUser = null;
        let selectedUser = null;
        let usersRef = null;
        let messagesRef = null;
        let statusRef = null;
        
        // Elementos del DOM
        const chatsList = document.getElementById('chatsList');
        const contactsList = document.getElementById('contactsList');
        const statusUpdates = document.getElementById('statusUpdates');
        const chatView = document.getElementById('chatView');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const backFromChat = document.getElementById('backFromChat');
        const myStatusAvatar = document.getElementById('myStatusAvatar');
        const myStatusName = document.getElementById('myStatusName');
        
        // Navegaci칩n
        const navTabs = document.querySelectorAll('.nav-tab');
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        // Generar clave de cifrado para cada chat
        function generateChatKey(userId1, userId2) {
            const chatId = [userId1, userId2].sort().join('_');
            return CryptoJS.SHA256(chatId + '_jayden_chat_key_2024').toString();
        }
        
        // Cifrar mensaje
        function encryptMessage(message, targetUserId) {
            const key = generateChatKey(currentUser.uid, targetUserId);
            return CryptoJS.AES.encrypt(message, key).toString();
        }
        
        // Descifrar mensaje
        function decryptMessage(encryptedMessage, senderUserId) {
            try {
                const key = generateChatKey(currentUser.uid, senderUserId);
                const bytes = CryptoJS.AES.decrypt(encryptedMessage, key);
                const decrypted = bytes.toString(CryptoJS.enc.Utf8);
                return decrypted || '游 Mensaje cifrado';
            } catch (error) {
                return '游 Mensaje cifrado';
            }
        }
        
        // Verificar autenticaci칩n
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                setupUser(user);
                loadUsers();
                loadChats();
                loadStatusUpdates();
                setupPresence();
            } else {
                window.location.href = 'index.html';
            }
        });
        
        // Configurar usuario
        function setupUser(user) {
            database.ref('users/' + user.uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    myStatusName.textContent = userData.name;
                    myStatusAvatar.textContent = userData.name.charAt(0).toUpperCase();
                } else {
                    const displayName = user.email.split('@')[0];
                    myStatusName.textContent = displayName;
                    myStatusAvatar.textContent = displayName.charAt(0).toUpperCase();
                    
                    database.ref('users/' + user.uid).set({
                        name: displayName,
                        email: user.email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            });
        }
        
        // Cargar usuarios para contactos
        function loadUsers() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                contactsList.innerHTML = '';
                const users = snapshot.val();
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            createContactItem(userId, user);
                        }
                    });
                }
            });
        }
        
        // Crear elemento de contacto
        function createContactItem(userId, user) {
            const contactItem = document.createElement('div');
            contactItem.className = 'contact-item';
            contactItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            contactItem.innerHTML = `
                <div class="contact-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="contactOnline-${userId}"></div>
                </div>
                <div class="contact-info">
                    <div class="contact-name">${user.name || 'Usuario'}</div>
                    <div class="contact-status" id="contactStatus-${userId}">
                        <i class="fas fa-circle"></i> En l칤nea
                    </div>
                </div>
            `;
            
            contactItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            contactsList.appendChild(contactItem);
            checkUserOnlineStatus(userId);
        }
        
        // Cargar chats
        function loadChats() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                chatsList.innerHTML = '';
                const users = snapshot.val();
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            createChatItem(userId, user);
                        }
                    });
                }
            });
        }
        
        // Crear elemento de chat
        function createChatItem(userId, user) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            chatItem.innerHTML = `
                <div class="chat-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="chatOnline-${userId}"></div>
                </div>
                <div class="chat-info">
                    <div class="chat-name">${user.name || 'Usuario'}</div>
                    <div class="last-message" id="lastMessage-${userId}">Haz clic para chatear</div>
                </div>
                <div class="chat-meta">
                    <div class="message-time" id="lastMessageTime-${userId}"></div>
                    <div class="unread-badge" id="unreadBadge-${userId}" style="display: none;">1</div>
                </div>
            `;
            
            chatItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            chatsList.appendChild(chatItem);
            checkUserOnlineStatus(userId);
            loadLastMessage(userId);
        }
        
        // Cargar 칰ltimos mensajes
        function loadLastMessage(userId) {
            const chatId = getChatId(currentUser.uid, userId);
            const lastMessageRef = database.ref('chats/' + chatId).orderByKey().limitToLast(1);
            
            lastMessageRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                const lastMessageElement = document.getElementById(`lastMessage-${userId}`);
                const lastMessageTimeElement = document.getElementById(`lastMessageTime-${userId}`);
                
                if (message) {
                    let messageText = message.text ? decryptMessage(message.text, message.senderId) : '';
                    
                    if (lastMessageElement) {
                        lastMessageElement.textContent = messageText.substring(0, 30) + (messageText.length > 30 ? '...' : '');
                    }
                    
                    if (lastMessageTimeElement) {
                        const time = new Date(message.timestamp);
                        lastMessageTimeElement.textContent = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    }
                }
            });
        }
        
        // Cargar estados
        function loadStatusUpdates() {
            statusRef = database.ref('status_updates').orderByChild('timestamp').limitToLast(10);
            
            statusRef.on('value', (snapshot) => {
                statusUpdates.innerHTML = '';
                const updates = snapshot.val();
                
                if (updates) {
                    Object.keys(updates).forEach((updateId) => {
                        const update = updates[updateId];
                        createStatusItem(updateId, update);
                    });
                }
            });
        }
        
        // Crear elemento de estado
        function createStatusItem(updateId, update) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            
            // Obtener informaci칩n del usuario
            database.ref('users/' + update.userId).once('value').then((userSnapshot) => {
                const user = userSnapshot.val();
                const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                
                statusItem.innerHTML = `
                    <div class="status-avatar-small">
                        ${avatarText}
                    </div>
                    <div class="status-content">
                        <div class="status-user">${user.name || 'Usuario'}</div>
                        <div class="status-text">${update.text || '游닝 Imagen'}</div>
                    </div>
                    <div class="status-time">${formatTime(update.timestamp)}</div>
                `;
            });
            
            statusUpdates.appendChild(statusItem);
        }
        
        // Verificar estado en l칤nea
        function checkUserOnlineStatus(userId) {
            const userStatusRef = database.ref('status/' + userId);
            
            userStatusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                const chatOnline = document.getElementById(`chatOnline-${userId}`);
                const contactOnline = document.getElementById(`contactOnline-${userId}`);
                const contactStatus = document.getElementById(`contactStatus-${userId}`);
                
                if (status && status.state === 'online') {
                    if (chatOnline) chatOnline.style.display = 'block';
                    if (contactOnline) contactOnline.style.display = 'block';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle"></i> En l칤nea';
                } else {
                    if (chatOnline) chatOnline.style.display = 'none';
                    if (contactOnline) contactOnline.style.display = 'none';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle" style="color: #666"></i> Desconectado';
                }
            });
        }
        
        // Configurar presencia
        function setupPresence() {
            const userStatusRef = database.ref('status/' + currentUser.uid);
            
            userStatusRef.set({
                state: 'online',
                lastChanged: firebase.database.ServerValue.TIMESTAMP
            });
            
            window.addEventListener('beforeunload', () => {
                userStatusRef.set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            });
        }
        
        // Abrir chat
        function openChat(userId, user) {
            selectedUser = { id: userId, ...user };
            
            document.getElementById('chatWithName').textContent = user.name || 'Usuario';
            chatView.classList.add('active');
            
            loadChatMessages(userId);
        }
        
        // Cargar mensajes del chat
        function loadChatMessages(userId) {
            chatMessages.innerHTML = '';
            
            const chatId = getChatId(currentUser.uid, userId);
            messagesRef = database.ref('chats/' + chatId);
            
            messagesRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });
        }
        
        // Mostrar mensaje en el chat
        function displayMessage(message) {
            const messageElement = document.createElement('div');
            
            const isSent = message.senderId === currentUser.uid;
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            
            const decryptedText = message.text ? decryptMessage(message.text, message.senderId) : '';
            
            const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                <div class="message-content">${decryptedText || ''}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Enviar mensaje
        function sendMessage() {
            const text = messageInput.value.trim();
            
            if (text && selectedUser) {
                const chatId = getChatId(currentUser.uid, selectedUser.id);
                const messageRef = database.ref('chats/' + chatId).push();
                const messageId = messageRef.key;
                
                const encryptedText = encryptMessage(text, selectedUser.id);
                
                messageRef.set({
                    text: encryptedText,
                    senderId: currentUser.uid,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    messageId: messageId
                });
                
                messageInput.value = '';
                adjustTextareaHeight();
            }
        }
        
        // ID 칰nico para chat
        function getChatId(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }
        
        // Formatear tiempo
        function formatTime(timestamp) {
            const time = new Date(timestamp);
            const now = new Date();
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Ahora';
            if (diffMins < 60) return `${diffMins}m`;
            return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        


        // Ajustar altura del textarea
        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 100) + 'px';
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navegaci칩n por pesta침as
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar pesta침as activas
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Actualizar navegaci칩n inferior
                    navItems.forEach(item => {
                        if (item.dataset.tab === tabId) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                    
                    // Mostrar secci칩n correspondiente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === tabId) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Navegaci칩n inferior
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar navegaci칩n inferior
                    navItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Actualizar pesta침as superiores
                    navTabs.forEach(tab => {
                        if (tab.dataset.tab === tabId) {
                            tab.classList.add('active');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                    
                    // Mostrar secci칩n correspondiente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === tabId) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Env칤o de mensajes
            sendMessageBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Ajustar altura del textarea din치micamente
            messageInput.addEventListener('input', adjustTextareaHeight);

            // Volver del chat
            backFromChat.addEventListener('click', function() {
                chatView.classList.remove('active');
                if (messagesRef) {
                    messagesRef.off();
                }
            });

            // Botones del header
            document.getElementById('searchBtn').addEventListener('click', function() {
                alert('Funcionalidad de b칰squeda en desarrollo');
            });

            document.getElementById('menuBtn').addEventListener('click', function() {
                alert('Men칰 de opciones en desarrollo');
            });

            // Estado personal
            document.querySelector('.my-status').addEventListener('click', function() {
                const statusText = prompt('쯈u칠 est치s pensando?');
                if (statusText && statusText.trim() !== '') {
                    const statusRef = database.ref('status_updates').push();
                    statusRef.set({
                        userId: currentUser.uid,
                        text: statusText,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    alert('Estado actualizado correctamente');
                }
            });

            // Datos de ejemplo inicial
            initializeSampleData();
        });

        // Inicializar datos de ejemplo
        function initializeSampleData() {
            // Verificar si ya existen datos para no duplicar
            database.ref('chats').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    createSampleChats();
                }
            });

            database.ref('status_updates').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    createSampleStatusUpdates();
                }
            });
        }

        // Crear chats de ejemplo
        function createSampleChats() {
            const sampleUsers = [
                { id: 'user1', name: 'Ana Garc칤a' },
                { id: 'user2', name: 'Carlos L칩pez' },
                { id: 'user3', name: 'Mar칤a Rodr칤guez' },
                { id: 'user4', name: 'David Mart칤nez' }
            ];

            sampleUsers.forEach(user => {
                const chatId = getChatId(currentUser.uid, user.id);
                const messages = [
                    { text: '춰Hola! 쮺칩mo est치s?', senderId: user.id },
                    { text: '춰Hola! Estoy bien, gracias. 쯏 t칰?', senderId: currentUser.uid },
                    { text: 'Todo bien por aqu칤. 쮿as visto el nuevo proyecto?', senderId: user.id },
                    { text: 'S칤, me parece muy interesante. Tenemos que coordinar una reuni칩n.', senderId: currentUser.uid }
                ];

                messages.forEach((message, index) => {
                    setTimeout(() => {
                        const encryptedText = encryptMessage(message.text, message.senderId === currentUser.uid ? user.id : currentUser.uid);
                        database.ref('chats/' + chatId).push().set({
                            text: encryptedText,
                            senderId: message.senderId,
                            timestamp: Date.now() - (messages.length - index) * 600000 // 10 minutos entre mensajes
                        });
                    }, index * 100);
                });
            });
        }

        // Crear estados de ejemplo
        function createSampleStatusUpdates() {
            const sampleStatuses = [
                { userId: 'user1', text: '춰D칤a productivo en el trabajo! 游눺' },
                { userId: 'user2', text: 'Disfrutando del fin de semana 游' },
                { userId: 'user3', text: 'Nuevo proyecto emocionante 游' },
                { userId: 'user4', text: 'Viajando por trabajo 九걾잺' }
            ];

            sampleStatuses.forEach((status, index) => {
                setTimeout(() => {
                    database.ref('status_updates').push().set({
                        userId: status.userId,
                        text: status.text,
                        timestamp: Date.now() - index * 3600000 // 1 hora entre estados
                    });
                }, index * 100);
            });

            // Crear usuarios de ejemplo
            const sampleUsers = {
                user1: { name: 'Ana Garc칤a', email: 'ana@example.com', createdAt: firebase.database.ServerValue.TIMESTAMP },
                user2: { name: 'Carlos L칩pez', email: 'carlos@example.com', createdAt: firebase.database.ServerValue.TIMESTAMP },
                user3: { name: 'Mar칤a Rodr칤guez', email: 'maria@example.com', createdAt: firebase.database.ServerValue.TIMESTAMP },
                user4: { name: 'David Mart칤nez', email: 'david@example.com', createdAt: firebase.database.ServerValue.TIMESTAMP }
            };

            Object.keys(sampleUsers).forEach(userId => {
                database.ref('users/' + userId).set(sampleUsers[userId]);
            });
        }

        // Funci칩n para cerrar sesi칩n (puedes agregar un bot칩n en el men칰)
        function logout() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
            
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch(error => {
                console.error('Error al cerrar sesi칩n:', error);
            });
        }

        // Manejar el evento de antes de descargar la p치gina
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
        });

        // Inicializar altura del textarea
        adjustTextareaHeight();
    </script>
</body>
</html>







